{% extends "base.html" %} {% block content %}
<div class="profile-container">
  <h2>User Profile</h2>

  <div class="profile-info">
    <p><strong>Username:</strong> {{ user.username }}</p>
    <p><strong>Email:</strong> {{ user.email }}</p>
    <p><strong>Role:</strong> {{ user.role }}</p>
    <!-- <p><strong>Member since:</strong> {{ user.created_at.strftime('%Y-%m-%d') }}</p> -->
  </div>

  <!-- Profile info section -->
  <div class="profile-info">
    <p>Username: {{ current_user.username }}</p>
    <p>Email: {{ current_user.email }}</p>
  </div>

  <!-- Favorites section -->
  <h3>Your Favorite Tabs ({{ favorites|length }})</h3>

  {% if favorites %}
  <form method="POST" action="{{ url_for('main.bulk_favorite_action') }}">
    <div class="bulk-actions">
      <button type="submit" name="action" value="remove" class="btn btn-danger">
        Remove Selected
      </button>
      <button
        type="submit"
        name="action"
        value="download"
        class="btn btn-primary"
      >
        Download Selected
      </button>
    </div>

    <div class="favorites-list">
      {% for tab in favorites %}
      <div class="favorite-tab card">
        <div class="card-body">
          <input
            type="checkbox"
            name="tab_ids"
            value="{{ tab.id }}"
            id="tab-{{ tab.id }}"
            class="favorite-checkbox"
          />
          <label for="tab-{{ tab.id }}">
            <h4>{{ tab.artist }} - {{ tab.song }}</h4>
            <p>Key: {{ tab.harp_key }} | Type: {{ tab.harp_type }}</p>
          </label>
          <div class="tab-actions">
            <a
              href="{{ url_for('main.tab_detail', tab_id=tab.id) }}"
              class="btn btn-sm btn-outline-primary"
            >
              View Tab
            </a>
            <a
              href="{{ url_for('main.toggle_favorite', tab_id=tab.id) }}"
              class="btn btn-sm btn-outline-danger"
            >
              â˜… Remove
            </a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </form>
  {% else %}
  <p>You haven't favorited any tabs yet.</p>
  {% endif %}

  <!-- Sorting options -->
  <div class="sort-options mt-3">
    <span>Sort by:</span>
    <a
      href="{{ url_for('main.profile', sort='recent') }}"
      class="btn btn-sm {% if sort_by == 'recent' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
    >
      Recently Added
    </a>
    <a
      href="{{ url_for('main.profile', sort='artist') }}"
      class="btn btn-sm {% if sort_by == 'artist' %}btn-primary{% else %}btn-outline-secondary{% endif %}"
    >
      Artist
    </a>
  </div>

  <div class="change-password">
    <h3>Change Password</h3>
    <form method="POST" action="{{ url_for('main.change_password') }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

      <div class="form-group">
        <label for="current_password">Current Password</label>
        <input
          type="password"
          id="current_password"
          name="current_password"
          required
        />
      </div>

      <div class="form-group">
        <label for="new_password">New Password</label>
        <input type="password" id="new_password" name="new_password" required />
      </div>

      <div class="form-group">
        <label for="confirm_password">Confirm New Password</label>
        <input
          type="password"
          id="confirm_password"
          name="confirm_password"
          required
        />
      </div>

      <button type="submit" class="btn btn-primary">Update Password</button>
    </form>
  </div>
</div>

{% block scripts %}
<script src="{{ url_for('static', filename='profile.js') }}"></script>
{% endblock %}
{% endblock %}
